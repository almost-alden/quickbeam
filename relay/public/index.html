<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quickbeam | Sender Dashboard</title>
    <style>
        :root { --primary: #673ab7; --bg: #f5f5f7; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 2rem; }
        .card { background: white; padding: 2rem; border-radius: 16px; shadow: 0 4px 20px rgba(0,0,0,0.08); width: 100%; max-width: 400px; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--primary); }
        p { color: #666; font-size: 0.9rem; margin-bottom: 2rem; }
        label { display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.8rem; text-transform: uppercase; color: #888; }
        input { width: 100%; padding: 0.8rem; margin-bottom: 1.5rem; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 1rem; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: opacity 0.2s; }
        button:hover { opacity: 0.9; }
        #result { margin-top: 2rem; display: none; padding: 1rem; background: #e8f5e9; border-radius: 8px; border: 1px solid #c8e6c9; }
        .link-text { font-family: monospace; word-break: break-all; color: #2e7d32; font-size: 0.9rem; }
        .copy-hint { font-size: 0.7rem; color: #666; margin-top: 0.5rem; }
    </style>
</head>
<body>
    <div class="card">
        <h1>Quickbeam ‚ö°Ô∏è</h1>
        <p>Send a video to a friend's Roku instantly.</p>

        <div id="roku-status" style="margin-bottom: 2rem; padding: 0.8rem; border-radius: 8px; font-size: 0.8rem; border: 1px solid #eee;">
            Checking Roku status...
        </div>
        
        <label>Your Name</label>
        <input type="text" id="senderName" placeholder="e.g. Johnny">

        <label>Video URL</label>
        <input type="text" id="videoUrl" placeholder="Paste YouTube, Netflix, or Prime link">

        <button onclick="generateLink()">Create Magic Link</button>

        <div id="result">
            <label>Magic Link Ready!</label>
            <div class="link-text" id="outputLink"></div>
            <div class="copy-hint">Copy this link and text it to your friend.</div>
        </div>
    </div>

    <script>
        async function checkStatus() {
            try {
                const res = await fetch('/api/status');
                const data = await res.json();
                const statusEl = document.getElementById('roku-status');
                if (data.active) {
                    statusEl.innerText = "‚úÖ A Roku TV is active on your network!";
                    statusEl.style.background = "#e8f5e9";
                    statusEl.style.borderColor = "#c8e6c9";
                    statusEl.style.color = "#2e7d32";
                } else {
                    statusEl.innerText = "üè† No Roku found on this network (IP: " + data.publicIp + ")";
                    statusEl.style.background = "#fff3e0";
                    statusEl.style.borderColor = "#ffe0b2";
                    statusEl.style.color = "#ef6c00";
                }
            } catch (e) {
                document.getElementById('roku-status').innerText = "Unable to check Roku status.";
            }
        }

        async function generateLink() {
            const senderName = document.getElementById('senderName').value;
            const url = document.getElementById('videoUrl').value;
            
            if (!url) return alert("Please paste a URL");

            try {
                const res = await fetch('/api/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, senderName })
                });
                
                const data = await res.json();
                if (data.relayUrl) {
                    document.getElementById('result').style.display = 'block';
                    document.getElementById('outputLink').innerText = data.relayUrl;
                } else {
                    alert("Error: " + (data.error || "Unknown error"));
                }
            } catch (e) {
                alert("Failed to connect to Relay server.");
            }
        }

        checkStatus();
        setInterval(checkStatus, 10000);
    </script>
</body>
</html>
